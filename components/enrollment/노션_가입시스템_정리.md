# 케어온 고객 가입 시스템 (Enrollment System)

## 📋 시스템 개요

총 19개의 스텝으로 구성된 고객 가입 프로세스입니다. 각 스텝은 특정 정보를 수집하고 검증합니다.

---

## 🔄 가입 프로세스 플로우

<details>
<summary><strong>Step 0: 약관 동의 ✅</strong></summary>

```
파일: step-0-agreements.tsx
타입: Agreement

## 케어온 가입을 위한 약관 동의가 필요해요

### 필수 동의
- [체크박스] 서비스 이용약관 (필수)
- [체크박스] 개인정보 수집 및 이용 (필수)

### 선택 동의
- [체크박스] 마케팅 정보 수신 동의 (선택)

### FormData 필드
- agreeTerms: boolean
- agreePrivacy: boolean
- agreeMarketing: boolean

### UI 요소
- [버튼] 전체 동의합니다
- [버튼] 다음

### Validation
- agreeTerms && agreePrivacy 필수
```

</details>

<details>
<summary><strong>Step 1: 대표자 정보 👤</strong></summary>

```
파일: step-1-owner-info.tsx
타입: Form

## 대표자 본인 정보를 입력해 주세요

### 입력 필드
- 대표자 성명 (ownerName: string)
- 생년월일 (birthDate: string) - 6자리
- 성별 (birthGender: string) - 1자리
- 통신사 (carrier: string)
  옵션: SKT / KT / LG U+ / 알뜰폰
- MVNO (mvnoCarrier: string) - 알뜰폰인 경우
- 휴대폰 번호 (phoneNumber: string)

### FormData 필드
- ownerName: string
- birthDate: string
- birthGender: string
- carrier: string
- mvnoCarrier: string
- phoneNumber: string

### Validation
- 이름, 생년월일, 성별, 통신사, 휴대폰 필수
- MVNO 선택 시 mvnoCarrier도 필수
```

</details>

<details>
<summary><strong>Step 1.5: 카드사 동의 💳</strong></summary>

```
파일: step-1.5-card-agreements-v2.tsx
타입: Agreement

## 카드사 가맹점 신청 동의

### 카드사별 동의서
- 우리카드 가맹점 동의서
- 비씨카드 가맹점 동의서
- 국민카드 가맹점 동의서
- 하나카드 가맹점 동의서
- 삼성카드 가맹점 동의서

### FormData 필드
- agreeTosspay: string | boolean
- agreedCardCompanies: string

### 동작
- 각 카드사 동의서 모달로 표시
- 토스페이 통합 동의로 처리
```

</details>

<details>
<summary><strong>Step 2: 사업자 정보 🏢</strong></summary>

```
파일: step-2-contact-business.tsx
타입: Form

## 사업자 정보를 입력해주세요

### 입력 필드
- 상호명 (businessName: string)
- 사업자등록번호 (businessNumber: string)
  - Validation: 정확히 10자리
- 이메일 (email: string)
  - Validation: @ 포함 필수

### FormData 필드
- businessName: string
- businessNumber: string (10자리)
- email: string

### Validation
- 모든 필드 필수 입력
- 사업자등록번호 10자리 검증
- 이메일 형식 검증
```

</details>

<details>
<summary><strong>Step 3: 매장 정보 🏪</strong></summary>

```
파일: step-3-store-info.tsx
타입: Form

## 매장 정보를 입력해주세요

### 입력 필드
- 간판명 (storeName: string)
  - [체크박스] 상호명과 동일
- 매장 주소 (storeAddress: string)
  - 다음 우편번호 API 연동
  - storePostcode: string
- 매장 면적 (storeArea: string)
  - [체크박스] 모르겠어요 (needLocalData: boolean)

### FormData 필드
- storeName: string
- storeAddress: string
- storePostcode: string
- storeArea: string
- needLocalData: boolean

### Validation
- 간판명, 주소 필수
- 면적 또는 needLocalData 중 하나 필수

### 외부 연동
- 다음 우편번호 API
```

</details>

<details>
<summary><strong>Step 4: 신청 유형 📝</strong></summary>

```
파일: step-4-application-type.tsx
타입: Selection

## 신청 유형을 선택해 주세요

### 선택지
1. 신규 가맹점 가입 (value: 'new')
2. 복수 가맹점 가입 (value: 'multiple')
   - 설명: 하나의 사업자번호로 여러개 사업장을 운영하려는 경우 신청합니다.

### FormData 필드
- applicationType: string

### 동작
- 라디오 버튼 선택 방식
```

</details>

<details>
<summary><strong>Step 4.5: 배달앱 서비스 🛵</strong></summary>

```
파일: step-4.5-delivery-app.tsx
타입: Custom

## 배달앱 가입 대행이 필요하신가요?

### 배달앱 로고 표시
- 배달의민족
- 요기요
- 쿠팡이츠

### 선택지
- 필요해요 → needDeliveryApp: true
- 지금은 아니에요 → needDeliveryApp: false

### 무료 제공 서비스
- 사업자 정보 등록 대행
- 메뉴 사진 촬영 및 등록
- 초기 설정 및 최적화
- 운영 교육 및 가이드

### FormData 필드
- needDeliveryApp: string | boolean
```

</details>

<details>
<summary><strong>Step 5: 사업자 형태 🏛️</strong></summary>

```
파일: step-5-business-type.tsx
타입: Selection

## 사업자 형태 확인이 필요해요

### 선택지
1. 개인 사업자 입니다 (value: '개인사업자')
2. 법인 사업자 입니다 (value: '법인사업자')

### FormData 필드
- businessType: string

### 중요 사항
법인사업자 선택 시 추가 서류 필요:
- 법인등기부등본
- 주주명부
```

</details>

<details>
<summary><strong>Step 6: 대표자 구성 👥</strong></summary>

```
파일: step-6-ownership-type.tsx
타입: Selection

## 공동 대표자 여부 확인이 필요해요

### 선택지
1. 단독 대표자입니다 (value: 'single')
2. 공동 대표자 입니다 (value: 'joint')

### FormData 필드
- ownershipType: string
```

</details>

<details>
<summary><strong>Step 7: 인허가 업종 📋</strong></summary>

```
파일: step-7-license-type.tsx
타입: Selection

## 해당하는 인허가 업종 유형을 알려주세요

### 선택지
1. 요식 업종(영업신고증 보유) (value: 'food')
2. 기타 업종(영업신고증 보유) (value: 'other')
3. 인허가 대상 업종이 아니에요 (value: 'none')

### FormData 필드
- licenseType: string

### 영향
- 'food' 또는 'other' 선택 시: Step 10에서 영업신고증 업로드 필수
```

</details>

<details>
<summary><strong>Step 8: 직종 💼</strong></summary>

```
파일: step-8-business-category.tsx
타입: Selection

## 직종이 무엇인가요?

### 선택지
1. 숙박 및 음식업 (value: 'accommodation_food')
2. 도소매업 (value: 'wholesale_retail')
3. 제조업 (value: 'manufacturing')
4. 기타 (value: 'other')

### FormData 필드
- businessCategory: string
```

</details>

<details>
<summary><strong>Step 8.7: 매출 정보 💰</strong></summary>

```
파일: step-8.7-sales-info.tsx
타입: Form

## 매출 정보

### 입력 필드
- 월 평균 매출 (monthlySales: string)
  선택: 500만원 미만 ~ 1억원 이상
- 카드 매출 비율 (cardSalesRatio: number)
  슬라이더: 0% ~ 100%
- 주력 상품/서비스 (mainProduct: string)
- 객단가 (unitPrice: string)
  선택: 1만원 미만 ~ 10만원 이상

### FormData 필드
- monthlySales: string
- cardSalesRatio: number
- mainProduct: string
- unitPrice: string

### Validation
- 모든 필드 필수 입력
```

</details>

<details>
<summary><strong>Step 8.3: 인터넷/CCTV 현황 📡</strong></summary>

```
파일: step-8.3-internet-cctv-check.tsx
타입: Custom

## 매장 시설 현황을 확인하겠습니다

### 질문 1: 인터넷
현재 매장에 인터넷이 설치되어 있나요?
- 네, 설치되어 있어요 → hasInternet: true
- 아니요, 없어요 → hasInternet: false

### 질문 2: CCTV
현재 매장에 CCTV가 설치되어 있나요?
- 네, 설치되어 있어요 → hasCCTV: true
- 아니요, 없어요 → hasCCTV: false

### FormData 필드
- hasInternet: string | boolean
- hasCCTV: string | boolean

### 영향
- Step 8.5의 무료 서비스 제공 여부 결정
```

</details>

<details>
<summary><strong>Step 8.5: 무료 서비스 🎁</strong></summary>

```
파일: step-8.5-free-service.tsx
타입: Custom

## 필요하신 서비스를 무료로 제공해드립니다

### 조건부 렌더링
표시 조건: !hasInternet || !hasCCTV
- 인터넷이나 CCTV가 없는 경우에만 표시
- 둘 다 있으면 자동으로 다음 스텝으로 이동

### 제공 서비스 (조건부)
인터넷 없으면:
🌐 초고속 인터넷 (500M 기가라이트) 1년 무료

CCTV 없으면:
📹 AI 지능형 CCTV 4대 (KT) 1년 무료

### 타이머
- D+2일 12시까지 카운트다운
- 실시간 남은 시간 표시

### 선택지
- 좋아요! 🎉 → wantFreeService: true
- 싫어요 → wantFreeService: false

### FormData 필드
- wantFreeService: string | boolean
```

</details>

<details>
<summary><strong>Step 9.5: 1차 완료 🎉</strong></summary>

```
파일: step-9.5-first-completion.tsx
타입: Custom

## 훌륭해요! 3장만 있으면 끝나요

### 축하 메시지
- 🎉 애니메이션 효과
- 중간 완료 축하

### 중요 안내
📍 매장과 가까이 있어야 해요

### 준비할 서류 체크리스트
✅ 사업자등록증
✅ 신분증
✅ 통장

### 안내 메시지
- 📸 사진으로 찍어 올리셔도 돼요
- 큰 파일도 괜찮아요 (최대 100MB)

### UI 요소
[버튼] 서류 업로드 하러가기
```

</details>

<details>
<summary><strong>Step 9.3: 정산 정보 💳</strong></summary>

```
파일: step-9.3-settlement-info.tsx
타입: Form

## 정산 계좌 정보를 입력해주세요

### 입력 필드
- 은행명 (bankName: string)
  - 드롭다운 선택
- 예금주 (accountHolder: string)
- 계좌번호 (accountNumber: string)

### FormData 필드
- bankName: string
- accountHolder: string
- accountNumber: string

### Validation
- 모든 필드 필수 입력
- 예금주/계좌번호 trim 후 검증
```

</details>

<details>
<summary><strong>Step 10: 서류 업로드 📎</strong></summary>

```
파일: step-10-document-upload.tsx
타입: Form

## 필요 서류를 업로드해주세요

### 필수 서류 (공통)
- 사업자등록증 (businessRegistrationUrl)
- 신분증 앞면 (idCardFrontUrl)
- 신분증 뒷면 (idCardBackUrl)
- 통장사본 (bankbookUrl)

### 조건부 서류
인허가 업종인 경우 (licenseType === 'food' || 'other'):
- 영업신고증 (businessLicenseUrl)

### 사업장 사진 (선택)
- 간판 사진 (signPhotoUrl)
- 문 닫힌 사진 (doorClosedUrl)
- 문 열린 사진 (doorOpenUrl)
- 내부 사진 (interiorUrl)
- 상품 사진 (productUrl)
- 명함 사진 (businessCardUrl)

### 법인 추가 서류 (businessType === '법인사업자')
- 법인등기부등본 (corporateRegistrationUrl)
- 주주명부 (shareholderListUrl)
- 인감증명서 (sealCertificateUrl)
- 인감사용승낙서 (sealUsageUrl)

### FormData 필드
- 모든 URL 필드: string | null

### 파일 제약
- 최대 파일 크기: 100MB
- 지원 형식: 이미지, PDF
```

</details>

<details>
<summary><strong>Step 11: 최종 확인 ✅</strong></summary>

```
파일: step-11-final-confirmation.tsx
타입: Custom

## 입력하신 정보를 최종 확인해주세요

### 표시 정보
- 대표자 정보
- 사업자 정보
- 매장 정보
- 선택한 서비스
- 업로드한 서류 목록

### 최종 확인
- 입력된 모든 정보 요약 표시
- 수정 필요 시 이전 단계로 이동 가능

### UI 요소
[버튼] 제출하기
```

</details>

<details>
<summary><strong>Step 12: 완료 🎊</strong></summary>

```
파일: step-12-success.tsx
타입: Custom

## 접수 완료!

### 완료 메시지
🎉 가입 신청이 완료되었습니다!

### 안내 사항
- 📱 보통 오늘 안에 연락드려요
- 💬 카카오톡으로 진행 현황을 알려드릴게요
- 📞 1866-1845 (문의 가능)

### 다음 단계
1. 서류 검토 (영업일 기준 1~2일)
2. 설치 일정 협의
3. 기사님 방문 설치

감사합니다! 🎉
```

</details>

---

## 📊 FormData 전체 구조 (50개 필드)

<details>
<summary><strong>Agreement (5개)</strong></summary>

```typescript
agreeTerms: boolean
agreePrivacy: boolean
agreeMarketing: boolean
agreeTosspay: string | boolean
agreedCardCompanies: string
```

</details>

<details>
<summary><strong>Owner (7개)</strong></summary>

```typescript
ownerName: string
representativeName: string
birthDate: string
birthGender: string
gender: 'male' | 'female'
carrier: string
mvnoCarrier: string
```

</details>

<details>
<summary><strong>Business (6개)</strong></summary>

```typescript
phoneNumber: string
businessName: string
businessNumber: string
email: string
businessAddress: string
businessDetailAddress: string
```

</details>

<details>
<summary><strong>Store (5개)</strong></summary>

```typescript
storeName: string
storeAddress: string
storePostcode: string
storeArea: string
needLocalData: boolean
```

</details>

<details>
<summary><strong>Types (6개)</strong></summary>

```typescript
applicationType: string
needDeliveryApp: string | boolean
businessType: string
ownershipType: string
licenseType: string
businessCategory: string
```

</details>

<details>
<summary><strong>Sales (4개)</strong></summary>

```typescript
monthlySales: string
cardSalesRatio: number
mainProduct: string
unitPrice: string
```

</details>

<details>
<summary><strong>Facilities (3개)</strong></summary>

```typescript
hasInternet: string | boolean
hasCCTV: string | boolean
wantFreeService: string | boolean
```

</details>

<details>
<summary><strong>Settlement (3개)</strong></summary>

```typescript
bankName: string
accountHolder: string
accountNumber: string
```

</details>

<details>
<summary><strong>Documents (15개)</strong></summary>

```typescript
businessRegistrationUrl: string | null
idCardFrontUrl: string | null
idCardBackUrl: string | null
bankbookUrl: string | null
businessLicenseUrl: string | null
signPhotoUrl: string | null
doorClosedUrl: string | null
doorOpenUrl: string | null
interiorUrl: string | null
productUrl: string | null
businessCardUrl: string | null
corporateRegistrationUrl: string | null
shareholderListUrl: string | null
sealCertificateUrl: string | null
sealUsageUrl: string | null
```

</details>

---

## 📈 Phase 1 완료 현황

<details>
<summary><strong>Config 시스템 구축 ✅</strong></summary>

```
### 생성된 파일
1. lib/enrollment/form-schema.ts
   - FormData 초기값 중앙화
   - 50개 필드 관리
   - Helper 함수 제공

2. lib/enrollment/enrollment-config.ts
   - 19개 스텝 설정 통합
   - Selection options 정의
   - Validation 로직 중앙화

### 스텝 타입 분류
Selection (5개): Step 4, 5, 6, 7, 8
Form (6개): Step 1, 2, 3, 8.7, 9.3, 10
Agreement (2개): Step 0, 1.5
Custom (6개): Step 4.5, 8.3, 8.5, 9.5, 11, 12

### 테스트 완료 항목
✅ FormData 타입 호환성
✅ 스텝 개수/순서 일치 (19개)
✅ Selection options 일치
✅ Validation 로직 수정
✅ 브라우저 실제 동작
✅ TypeScript 컴파일
✅ Helper 함수 작동
✅ 헤더 UI 문제 해결
```

</details>

---

## 🚀 Phase 2 계획

<details>
<summary><strong>제네릭 컴포넌트 개발</strong></summary>

```typescript
### 1. SelectionStep
interface SelectionStepProps {
  stepConfig: StepConfig
  formData: FormData
  onSelect: (value: string) => void
  onNext: () => void
  onBack: () => void
}
// 적용: Step 4, 5, 6, 7, 8

### 2. FormStep
interface FormStepProps {
  stepConfig: StepConfig
  formData: FormData
  updateFormData: (field, value) => void
  onNext: () => void
  onBack: () => void
}
// 적용: Step 1, 2, 3, 8.7, 9.3

### 3. StepRouter
switch (step.type) {
  case 'selection':
    return <SelectionStep />
  case 'form':
    return <FormStep />
  case 'custom':
    return <CustomStep />
}
```

</details>

<details>
<summary><strong>Phase 3: 마이그레이션</strong></summary>

```
### page.tsx 간소화
- stepComponents 배열 제거
- StepRouter로 대체
- 200줄 → 50줄

### 이점
- Config만 수정하면 스텝 변경
- 코드 중복 제거
- 유지보수성 향상
```

</details>

---

## 🔗 스텝 플로우 다이어그램

```
Step 0 → Step 1 → Step 1.5 → Step 2 → Step 3 → Step 4 → Step 4.5
→ Step 5 → Step 6 → Step 7 → Step 8 → Step 8.7 → Step 8.3
→ Step 8.5 → Step 9.5 → Step 9.3 → Step 10 → Step 11 → Step 12
```

---

## 📝 주요 외부 연동

- **다음 우편번호 API** (Step 3)
- **파일 업로드 시스템** (Step 10)
- **토스페이 통합 동의** (Step 1.5)

---

**문서 생성일:** 2025-10-01
**프로젝트:** 케어온 (CareOn)
**문서 위치:** `/components/enrollment/`
