# ê´€ë¦¬ì ë©”ì‹œì§€ ë°œì†¡ ì‹œìŠ¤í…œ êµ¬í˜„ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

ì¼€ì–´ì˜¨ ê´€ë¦¬ì ë©”ì‹œì§€ ë°œì†¡ ì‹œìŠ¤í…œì€ SMSì™€ ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ì„ í†µí•© ê´€ë¦¬í•˜ëŠ” ì¢…í•© ë©”ì‹œì§• í”Œë«í¼ì…ë‹ˆë‹¤.

## ğŸš€ ì£¼ìš” ê¸°ëŠ¥

### 1. í†µí•© ë©”ì‹œì§€ ë°œì†¡
- **SMS/LMS ë°œì†¡**: ê°œë³„ ë° ëŒ€ëŸ‰ ë°œì†¡ ì§€ì›
- **ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡**: í…œí”Œë¦¿ ê¸°ë°˜ ë°œì†¡
- **ê³ ê° ë°ì´í„°ë² ì´ìŠ¤ ì—°ë™**: ë“±ë¡ëœ ê³ ê° ì„ íƒ ë°œì†¡
- **ë©”ì‹œì§€ ì´ë ¥ ì¶”ì **: ëª¨ë“  ë°œì†¡ ë‚´ì—­ ì €ì¥ ë° ì¡°íšŒ

### 2. ê³ ê° ì„ íƒ ê¸°ëŠ¥
- **ê·¸ë£¹ë³„ ì„ íƒ**: ì „ì²´ ê³ ê°, í™œì„± ê³ ê°, ê°€ì… ì‹ ì²­ì ë“±
- **ìˆ˜ë™ ì„ íƒ**: ê°œë³„ ê³ ê° ì„ íƒ
- **ê²€ìƒ‰ ê¸°ëŠ¥**: ì´ë¦„, ì „í™”ë²ˆí˜¸, ì—…ì²´ëª…ìœ¼ë¡œ ê²€ìƒ‰
- **ì¤‘ë³µ ì œê±°**: ìë™ ì¤‘ë³µ ì „í™”ë²ˆí˜¸ í•„í„°ë§

### 3. ë©”ì‹œì§€ ì´ë ¥ ê´€ë¦¬
- **ë°œì†¡ ìƒíƒœ ì¶”ì **: ë°œì†¡, ì „ë‹¬, ì‹¤íŒ¨ ìƒíƒœ ê´€ë¦¬
- **í†µê³„ ëŒ€ì‹œë³´ë“œ**: ë°œì†¡ í†µê³„ ì‹¤ì‹œê°„ í™•ì¸
- **í•„í„°ë§ ê²€ìƒ‰**: ë‚ ì§œ, ìƒíƒœ, ë©”ì‹œì§€ ìœ í˜•ë³„ ì¡°íšŒ
- **ì˜¤ë¥˜ ì¶”ì **: ì‹¤íŒ¨ ì›ì¸ ì €ì¥ ë° í‘œì‹œ

### 4. í…œí”Œë¦¿ ê´€ë¦¬
- **ì‚¬ì „ ì •ì˜ í…œí”Œë¦¿**: ìì£¼ ì‚¬ìš©í•˜ëŠ” ë©”ì‹œì§€ ì €ì¥
- **ë³€ìˆ˜ ì§€ì›**: ë™ì  ë‚´ìš© ì¹˜í™˜
- **ìŠ¹ì¸ ìƒíƒœ ê´€ë¦¬**: ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ í…œí”Œë¦¿ ìŠ¹ì¸ ì¶”ì 

## ğŸ“ ì‹œìŠ¤í…œ êµ¬ì¡°

\`\`\`
app/admin/messages/
â”œâ”€â”€ page.tsx                    # ë©”ì¸ ë©”ì‹œì§€ ë°œì†¡ í˜ì´ì§€
â”œâ”€â”€ api/
â”‚   â””â”€â”€ admin/
â”‚       â””â”€â”€ messages/
â”‚           â”œâ”€â”€ send/           # í†µí•© ë©”ì‹œì§€ ë°œì†¡ API
â”‚           â”œâ”€â”€ history/        # ë°œì†¡ ì´ë ¥ ì¡°íšŒ API
â”‚           â”œâ”€â”€ batch/          # ëŒ€ëŸ‰ ë°œì†¡ API
â”‚           â”œâ”€â”€ templates/      # í…œí”Œë¦¿ ê´€ë¦¬ API
â”‚           â””â”€â”€ customers/      # ê³ ê° ì¡°íšŒ API
â”‚
components/admin/messages/
â”œâ”€â”€ MessageHistory.tsx          # ë°œì†¡ ì´ë ¥ ì»´í¬ë„ŒíŠ¸
â”œâ”€â”€ CustomerSelector.tsx        # ê³ ê° ì„ íƒ ì»´í¬ë„ŒíŠ¸
â””â”€â”€ TemplateManager.tsx         # í…œí”Œë¦¿ ê´€ë¦¬ ì»´í¬ë„ŒíŠ¸
â”‚
lib/ppurio/
â”œâ”€â”€ sms-v2.ts                   # SMS ë°œì†¡ ë¼ì´ë¸ŒëŸ¬ë¦¬
â””â”€â”€ kakao-alimtalk.ts          # ì•Œë¦¼í†¡ ë°œì†¡ ë¼ì´ë¸ŒëŸ¬ë¦¬
â”‚
supabase/migrations/
â””â”€â”€ 20250126_create_message_history.sql  # ë©”ì‹œì§€ ì´ë ¥ í…Œì´ë¸”
\`\`\`

## ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### message_history í…Œì´ë¸”
\`\`\`sql
- id: ê³ ìœ  ID
- message_type: SMS/LMS/ALIMTALK
- recipient_phone: ìˆ˜ì‹ ì ì „í™”ë²ˆí˜¸
- recipient_name: ìˆ˜ì‹ ì ì´ë¦„
- customer_id: ê³ ê° ID (ì°¸ì¡°)
- enrollment_id: ê°€ì…ì‹ ì²­ ID (ì°¸ì¡°)
- message_content: ë©”ì‹œì§€ ë‚´ìš©
- status: pending/sent/delivered/failed
- error_message: ì˜¤ë¥˜ ë©”ì‹œì§€
- sent_at: ë°œì†¡ ì‹œê°„
- created_at: ìƒì„± ì‹œê°„
\`\`\`

### message_templates í…Œì´ë¸”
\`\`\`sql
- id: ê³ ìœ  ID
- name: í…œí”Œë¦¿ ì´ë¦„
- code: í…œí”Œë¦¿ ì½”ë“œ
- message_type: SMS/LMS/ALIMTALK
- content: í…œí”Œë¦¿ ë‚´ìš©
- variables: ë³€ìˆ˜ ì •ì˜ (JSON)
- is_active: í™œì„± ìƒíƒœ
- approval_status: ìŠ¹ì¸ ìƒíƒœ
\`\`\`

### message_batch_jobs í…Œì´ë¸”
\`\`\`sql
- id: ê³ ìœ  ID
- job_name: ì‘ì—…ëª…
- message_type: ë©”ì‹œì§€ ìœ í˜•
- template_id: í…œí”Œë¦¿ ID
- total_recipients: ì „ì²´ ìˆ˜ì‹ ì ìˆ˜
- sent_count: ë°œì†¡ ì„±ê³µ ìˆ˜
- failed_count: ë°œì†¡ ì‹¤íŒ¨ ìˆ˜
- status: pending/processing/completed/failed
\`\`\`

## ğŸ”§ ì„¤ì¹˜ ë° ì„¤ì •

### 1. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
`.env.local` íŒŒì¼ì— ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€:

\`\`\`bash
# ë¿Œë¦¬ì˜¤ SMS/ì•Œë¦¼í†¡ API
PPURIO_USERNAME=your_username
PPURIO_API_KEY=your_api_key
PPURIO_SENDER_PROFILE=@your_profile  # ì¹´ì¹´ì˜¤ ë°œì‹ í”„ë¡œí•„

# Supabase
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_service_role_key
\`\`\`

### 2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©

#### ë°©ë²• 1: ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
\`\`\`bash
node scripts/apply-message-history-migration.js
\`\`\`

#### ë°©ë²• 2: Supabase Dashboard SQL Editor
1. Supabase Dashboard > SQL Editor ì ‘ì†
2. `supabase/migrations/20250126_create_message_history.sql` íŒŒì¼ ë‚´ìš© ë³µì‚¬
3. SQL Editorì— ë¶™ì—¬ë„£ê¸° ë° ì‹¤í–‰

### 3. ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì„¤ì •
1. ì¹´ì¹´ì˜¤ ë¹„ì¦ˆë‹ˆìŠ¤ ì±„ë„ ê´€ë¦¬ì ì ‘ì†
2. ì•Œë¦¼í†¡ í…œí”Œë¦¿ ì‹ ì²­
3. ìŠ¹ì¸ í›„ í…œí”Œë¦¿ ì½”ë“œë¥¼ `lib/ppurio/kakao-alimtalk.ts`ì— ì—…ë°ì´íŠ¸

## ğŸ“± ì‚¬ìš© ë°©ë²•

### ê´€ë¦¬ì í˜ì´ì§€ ì ‘ì†
\`\`\`
http://localhost:3000/admin/messages
\`\`\`

### SMS ê°œë³„ ë°œì†¡
1. "ë©”ì‹œì§€ ë°œì†¡" íƒ­ ì„ íƒ
2. "SMS ë¬¸ì" íƒ­ ì„ íƒ
3. "ê°œë³„ ë°œì†¡" ì„ íƒ
4. ìˆ˜ì‹ ë²ˆí˜¸ì™€ ë©”ì‹œì§€ ì…ë ¥
5. "SMS ë°œì†¡" ë²„íŠ¼ í´ë¦­

### SMS ëŒ€ëŸ‰ ë°œì†¡
1. "ëŒ€ëŸ‰ ë°œì†¡" ì„ íƒ
2. ìˆ˜ì‹ ì ì„ íƒ ë°©ë²• ì„ íƒ:
   - ê³ ê° ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì„ íƒ
   - ì§ì ‘ ì…ë ¥
3. ë©”ì‹œì§€ ë‚´ìš© ì…ë ¥
4. "ëŒ€ëŸ‰ ë°œì†¡" ë²„íŠ¼ í´ë¦­

### ì•Œë¦¼í†¡ ë°œì†¡
1. "ì¹´ì¹´ì˜¤ ì•Œë¦¼í†¡" íƒ­ ì„ íƒ
2. í…œí”Œë¦¿ ìœ í˜• ì„ íƒ:
   - ê°€ì… ì™„ë£Œ
   - ìŠ¹ì¸ ì™„ë£Œ
   - ê³ ê° ê³µì§€
3. í•„ìˆ˜ ì •ë³´ ì…ë ¥
4. "ì•Œë¦¼í†¡ ë°œì†¡" ë²„íŠ¼ í´ë¦­

### ë°œì†¡ ì´ë ¥ ì¡°íšŒ
1. "ë°œì†¡ ì´ë ¥" íƒ­ ì„ íƒ
2. í•„í„° ì˜µì…˜ ì‚¬ìš©:
   - ë©”ì‹œì§€ ìœ í˜•
   - ìƒíƒœ
   - ë‚ ì§œ ë²”ìœ„
   - ì „í™”ë²ˆí˜¸ ê²€ìƒ‰

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸

### í†µí•© ë©”ì‹œì§€ ë°œì†¡
\`\`\`typescript
POST /api/admin/messages/send
{
  messageType: "SMS" | "LMS" | "ALIMTALK",
  recipients: [{
    phone: string,
    name?: string,
    customerId?: number,
    variables?: object
  }],
  content: string,
  templateType?: string,
  templateCode?: string,
  variables?: object,
  saveHistory?: boolean
}
\`\`\`

### ë°œì†¡ ì´ë ¥ ì¡°íšŒ
\`\`\`typescript
GET /api/admin/messages/history?page=1&limit=20&type=SMS&status=sent
\`\`\`

### ëŒ€ëŸ‰ ë°œì†¡ ì‘ì—… ìƒì„±
\`\`\`typescript
POST /api/admin/messages/batch
{
  job_name: string,
  message_type: string,
  recipients: array,
  content: string,
  scheduled_at?: string
}
\`\`\`

### ê³ ê° ëª©ë¡ ì¡°íšŒ
\`\`\`typescript
GET /api/admin/messages/customers?search=í™ê¸¸ë™&page=1

POST /api/admin/messages/customers
{
  groupType: "all_customers" | "active_customers" | "pending_enrollments",
  filters: object
}
\`\`\`

### í…œí”Œë¦¿ ê´€ë¦¬
\`\`\`typescript
GET /api/admin/messages/templates?type=ALIMTALK&active=true

POST /api/admin/messages/templates
{
  name: string,
  code?: string,
  message_type: string,
  content: string,
  variables?: object
}
\`\`\`

## ğŸ¨ UI ì»´í¬ë„ŒíŠ¸

### CustomerSelector
ê³ ê° ì„ íƒì„ ìœ„í•œ ì»´í¬ë„ŒíŠ¸:

\`\`\`tsx
import CustomerSelector from '@/components/admin/messages/CustomerSelector'

<CustomerSelector
  onSelectionChange={(customers) => console.log(customers)}
  selectedCustomers={[]}
/>
\`\`\`

### MessageHistory
ë°œì†¡ ì´ë ¥ í‘œì‹œ ì»´í¬ë„ŒíŠ¸:

\`\`\`tsx
import MessageHistory from '@/components/admin/messages/MessageHistory'

<MessageHistory />
\`\`\`

## ğŸ› ë¬¸ì œ í•´ê²°

### ë©”ì‹œì§€ ë°œì†¡ ì‹¤íŒ¨
1. í™˜ê²½ ë³€ìˆ˜ í™•ì¸ (PPURIO_API_KEY, PPURIO_USERNAME)
2. ì „í™”ë²ˆí˜¸ í˜•ì‹ í™•ì¸ (í•˜ì´í”ˆ í¬í•¨ ê°€ëŠ¥)
3. ë©”ì‹œì§€ ê¸¸ì´ í™•ì¸ (SMS: 90ë°”ì´íŠ¸, LMS: 2000ë°”ì´íŠ¸)

### ì•Œë¦¼í†¡ ë°œì†¡ ì‹¤íŒ¨
1. í…œí”Œë¦¿ ìŠ¹ì¸ ìƒíƒœ í™•ì¸
2. ë°œì‹ í”„ë¡œí•„ ì„¤ì • í™•ì¸ (PPURIO_SENDER_PROFILE)
3. í…œí”Œë¦¿ ë³€ìˆ˜ ë§¤í•‘ í™•ì¸

### ë°ì´í„°ë² ì´ìŠ¤ ì˜¤ë¥˜
1. Supabase ì—°ê²° í™•ì¸
2. RLS ì •ì±… í™•ì¸ (í˜„ì¬ ë¹„í™œì„±í™”ë¨)
3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© ìƒíƒœ í™•ì¸

## ğŸ“Š ëª¨ë‹ˆí„°ë§

### ë°œì†¡ í†µê³„ í™•ì¸
- ê´€ë¦¬ì í˜ì´ì§€ì—ì„œ ì‹¤ì‹œê°„ í†µê³„ í™•ì¸
- ì „ì²´ ë°œì†¡, ì„±ê³µ, ì‹¤íŒ¨ ê±´ìˆ˜ í‘œì‹œ
- ì¼ë³„/ì›”ë³„ í†µê³„ ì¡°íšŒ ê°€ëŠ¥

### ì˜¤ë¥˜ ì¶”ì 
- message_history í…Œì´ë¸”ì˜ error_message í•„ë“œ í™•ì¸
- ì‹¤íŒ¨í•œ ë©”ì‹œì§€ ì¬ë°œì†¡ ê¸°ëŠ¥
- ì˜¤ë¥˜ íŒ¨í„´ ë¶„ì„ ë° ê°œì„ 

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

1. **API ì¸ì¦**: ëª¨ë“  APIëŠ” ê´€ë¦¬ì ì¸ì¦ í•„ìš”
2. **ë°ì´í„° ì•”í˜¸í™”**: ì „í™”ë²ˆí˜¸ ë“± ê°œì¸ì •ë³´ ë³´í˜¸
3. **ë°œì†¡ ì œí•œ**: ëŒ€ëŸ‰ ë°œì†¡ ì‹œ ë ˆì´íŠ¸ ë¦¬ë°‹ ì ìš©
4. **ë¡œê·¸ ê´€ë¦¬**: ëª¨ë“  ë°œì†¡ ë‚´ì—­ ì¶”ì  ê°€ëŠ¥

## ğŸ“ˆ í–¥í›„ ê°œì„  ì‚¬í•­

1. **ì˜ˆì•½ ë°œì†¡**: íŠ¹ì • ì‹œê°„ì— ìë™ ë°œì†¡
2. **MMS ì§€ì›**: ì´ë¯¸ì§€ í¬í•¨ ë©”ì‹œì§€
3. **A/B í…ŒìŠ¤íŠ¸**: ë©”ì‹œì§€ íš¨ê³¼ ì¸¡ì •
4. **ì›¹í›… ì—°ë™**: ë°œì†¡ ê²°ê³¼ ì‹¤ì‹œê°„ ì•Œë¦¼
5. **ëŒ€ì‹œë³´ë“œ ê°•í™”**: ìƒì„¸ ë¶„ì„ ë¦¬í¬íŠ¸

## ğŸ“ ì§€ì›

ë¬¸ì œ ë°œìƒ ì‹œ ë‹¤ìŒ ê²½ë¡œë¡œ ë¬¸ì˜:
- GitHub Issues: https://github.com/careon/care_on/issues
- ê¸°ìˆ  ì§€ì›: dev@careon.co.kr
